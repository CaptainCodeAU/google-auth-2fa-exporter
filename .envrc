# google_auth_2fa_exporter Python Environment

# Essential venv activation (must be included)
# Only set VIRTUAL_ENV_PROMPT and activate if venv actually exists
if [[ -d ".venv" ]]; then
    export VIRTUAL_ENV_PROMPT="($(basename "$PWD"))"
    source .venv/bin/activate
elif [[ -d "venv" ]]; then
    export VIRTUAL_ENV_PROMPT="($(basename "$PWD"))"
    source venv/bin/activate
fi

# Clear the "direnv: loading..." line
printf "\033[A\033[2K"

echo ""
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo -e "â”‚                        \033[35mğŸ” google-auth-2fa-exporter\033[0m                          â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo "â”‚"
echo "â”‚  ğŸš€ Quick Start:"
echo "â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo -e "â”‚     \033[3;33mgoogle-auth-2fa-exporter\033[0m                # Launch the TUI"
echo -e "â”‚     \033[3;33muv run python main.py\033[0m                   # Launch TUI (alt)"
echo -e "â”‚     \033[3;33mgoogle-auth-2fa-exporter --help\033[0m         # Show CLI help"
echo "â”‚"
echo "â”‚  ğŸ§ª Testing:"
echo "â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo -e "â”‚     \033[3;33muv run pytest\033[0m              # Run all tests"
echo -e "â”‚     \033[3;33muv run pytest -v\033[0m           # Verbose output"
echo -e "â”‚     \033[3;33muv run pytest --cov\033[0m        # With coverage report"
echo "â”‚"
echo "â”‚  ğŸ”§ Code Quality:"
echo "â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo -e "â”‚     \033[3;33muv run ruff check src/ tests/\033[0m  # Lint code"
echo -e "â”‚     \033[3;33muv run ruff format src/ tests/\033[0m # Format code"
echo -e "â”‚     \033[3;33muv run mypy src/\033[0m               # Type check"
echo "â”‚"
echo "â”‚  ğŸ“¦ Package Management:"
echo "â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo -e "â”‚     \033[3;33muv add <package>\033[0m           # Add to dependencies"
echo -e "â”‚     \033[3;33muv pip list\033[0m                # List installed packages"
echo "â”‚"
echo "â”‚  ğŸ”„ Development:"
echo "â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo -e "â”‚     \033[3;33muv sync --group dev\033[0m        # Install with dev deps"
echo -e "â”‚     \033[3;33muv pip install -e .\033[0m        # Reinstall in editable mode"
echo "â”‚"
echo "â”‚  ğŸ” Protobuf (after editing google_auth.proto):"
echo "â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo -e "â”‚     \033[3;33muv run python -m grpc_tools.protoc -I. --python_out=. --mypy_out=. google_auth.proto\033[0m"
echo -e "â”‚     \033[3;33mcp google_auth_pb2.py google_auth_pb2.pyi src/google_auth_2fa_exporter/\033[0m"
echo "â”‚"
echo "â”‚  â„¹ï¸  Info:"
echo "â”‚  â”€â”€â”€â”€â”€â”€â”€â”€"
echo -e "â”‚     Python: \033[36m$(uv run python --version 2>&1 | cut -d' ' -f2)\033[0m"
echo -e "â”‚     Binary: \033[36m$(which python)\033[0m"
echo -e "â”‚     Project: \033[36m$(basename "$PWD")\033[0m"
echo -e "â”‚     Version: \033[36m$(uv run python -c "import google_auth_2fa_exporter; print(google_auth_2fa_exporter.__version__)" 2>/dev/null || echo "0.1.0")\033[0m"
echo "â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "â”‚  â„¹ï¸  Environment Info:"
echo "â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo -e "â”‚     Machine: \033[36m$(hostname)\033[0m"
echo -e "â”‚     Kernel:  \033[36m$(uname -r)\033[0m"
echo -e "â”‚     Shell:   \033[36m$SHELL\033[0m"
echo "â”‚"
echo "â”‚  ğŸ“ VSCode Settings Check:"
echo "â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
if [[ "$(uname -s)" == "Darwin" ]]; then
    # macOS - check local app settings
    if grep -q "titleBar.activeBackground" "$HOME/Library/Application Support/Code/User/settings.json" 2>/dev/null; then
        echo -e "â”‚     VSCode:  \033[32mâœ“ Configured\033[0m"
    else
        echo -e "â”‚     VSCode:  \033[33mâœ— Not configured\033[0m"
    fi
    if grep -q "titleBar.activeBackground" "$HOME/Library/Application Support/Cursor/User/settings.json" 2>/dev/null; then
        echo -e "â”‚     Cursor:  \033[32mâœ“ Configured\033[0m"
    else
        echo -e "â”‚     Cursor:  \033[33mâœ— Not configured\033[0m"
    fi
else
    # Linux/WSL - check remote server settings
    if [[ -f "$HOME/.vscode-server/data/Machine/settings.json" ]]; then
        echo -e "â”‚     VSCode:  \033[32mâœ“ Found\033[0m"
    else
        echo -e "â”‚     VSCode:  \033[33mâœ— Not found\033[0m"
    fi
    if [[ -f "$HOME/.cursor-server/data/Machine/settings.json" ]]; then
        echo -e "â”‚     Cursor:  \033[32mâœ“ Found\033[0m"
    else
        echo -e "â”‚     Cursor:  \033[33mâœ— Not found\033[0m"
    fi
fi
echo "â”‚"
echo "â”‚  ğŸ”— Global CLI Status:"
echo "â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
if command -v uv &>/dev/null; then
    local _cli_status
    _cli_status=$(uv tool list 2>/dev/null | grep -iE "^google_auth_2fa_exporter[[:space:]]|^google-auth-2fa-exporter[[:space:]]" | head -n 1)
    if [[ -n "$_cli_status" ]]; then
        local _cli_version=$(echo "$_cli_status" | awk '{print $2}')
        echo -e "â”‚     Tool:    \033[32mâœ“ Installed via uv tool ($_cli_version)\033[0m"
        # Show executable paths
        local _in_tool=false
        while IFS= read -r _line; do
            if [[ "$_in_tool" == true ]]; then
                if [[ "$_line" == -\ * ]]; then
                    local _exec_name=$(echo "$_line" | sed 's/^- //')
                    echo -e "â”‚     Binary:  \033[36m~/.local/bin/$_exec_name\033[0m"
                else
                    break
                fi
            fi
            if echo "$_line" | grep -qiE "^google_auth_2fa_exporter[[:space:]]|^google-auth-2fa-exporter[[:space:]]"; then
                _in_tool=true
            fi
        done <<< "$(uv tool list 2>/dev/null)"
    else
        echo -e "â”‚     Tool:    \033[33mâœ— Not installed globally\033[0m"
        echo -e "â”‚     Hint:    \033[3;33muv_tool_install_current_project dev\033[0m"
    fi
else
    echo -e "â”‚     Tool:    \033[31mâœ— uv not found\033[0m"
fi
echo "â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
